<div id="root"> </div>

<script src="https://unpkg.com/react@16/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/redux@latest/dist/redux.min.js"></script>
<script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
<script src="https://unpkg.com/react-redux@5.0.7/dist/react-redux.js"></script>
<script src='../components/itemComponent'

<script type="text/babel">
const {createStore, applyMiddleware, compose, combineReducers} = Redux;
const {connect, Provider} = ReactRedux;
//const AllItems = require('../components/itemComponent')

const ADD_PLAYER ='ADD_PLAYER'
const DELETE_PLAYER ='DELETE_PLAYER'
const PLAYER_ACTIVE = 'PLAYER_ACTIVE'
const CHECK_PLAYER ='CHECK_PLAYER'
var runningId = 10

function addPlayer(name, active){
  return { type: ADD_PLAYER, name, active }
}
function deletePlayer(id) {
  console.log("Deleting player");
  return { type: DELETE_PLAYER, id }
}
function checkPlayer(name, active, id) {
  return { type: CHECK_PLAYER, name, active, id }
}
function playerActive(id) {
  return { type: PLAYER_ACTIVE, id }
}

const secondState = [{
  name: "Teuvo",
  active: true,
  id: 1
}, {
  name: "Jaakko",
  active: false,
  id: 2
}];

const initialState = [{
  name: "Teuvo",
  active: true,
  id: 1
}];

function reducer(state = initialState, action){
  switch(action.type) {
    case 'CHECK_PLAYER':
      var newState = [{
        name: action.name,
        active: action.active,
        id: action.id
      }]
      return newState

    case 'DELETE_PLAYER':
      //console.log("Doesnt this work?");
      var newState = [{name: "", active: false}];
      return newState;

    case 'PLAYER_ACTIVE':
      console.log("asd");
      var newState = [{
        name: state[0].name,
        active: false,
        id: action.id
      }]
      return newState;

    default:
      return state
  }
}

function secondReducer(state = secondState, action) {
  switch (action.type) {

    case 'ADD_PLAYER':
      runningId++;
      const newState = [...state, {
        name: action.name,
        active: action.active,
        id: runningId
      }]
      return newState

    case 'DELETE_PLAYER':
      console.log("Now I delete player with id " + action.id);
      const undeletedPlayers = [];
      for (var i = 0; i < state.length; i++) {
        if (!(action.id == state[i].id)) {
          undeletedPlayers.push(state[i]);
        }
      }
      return undeletedPlayers

    case 'PLAYER_ACTIVE':
      const updatedPlayers = [];
      for (var i = 0; i < state.length; i++) {
        if (!(action.id == state[i].id)) {
          updatedPlayers.push(state[i]);
        }
        else {
          var updatedPlayer = {
             name: state[i].name,
             active: false/*!state[i].active*/,
             id: state[i].id
          }
          updatedPlayers.push(updatedPlayer);
        }
      }
      return updatedPlayers

    default:
      return state;
  }
}

const ultimateReducer = combineReducers({
  reducer,
  secondReducer
});

const composeEnchancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;
const store = createStore(ultimateReducer, composeEnchancers());

function Counter({count, player, increment, decrement, reset}) {
  return (
    <div>
      <button onClick={decrement}>-</button>
      <span> {count}</span>
      <button onClick={increment}>+</button>
      <button onClick={reset}>reset</button>
      <span> {player[0].name}</span>
    </div>
  );
}

function AllPlayers({player, addPlayer, checkPlayer}) {
  let listOfPlayers = []
  for (let i = 0; i < player.length; ++i) {
    listOfPlayers.push(
    <div>
      <button onClick={() => checkPlayer(player[i].name, player[i].active, player[i].id)}> {player[i].name}</button>
    </div>
    );
  }
  return (
    <div>
      <div>Players:
        {listOfPlayers}
      </div>
    </div>
  );
};

function DetailedPlayer({singlePlayer, deletePlayer, player, playerActive}) {
  var details = "";
  if (singlePlayer[0].name.length > 0) {
    details =
    <div>
      <p>Name: {singlePlayer[0].name}, active: {singlePlayer[0].active.toString()}</p>
      <button onClick={() => deletePlayer(singlePlayer[0].id)}> Delete</button>
      <button onClick={() => playerActive(singlePlayer[0].id)}> Not active</button>
    </div>
  }
  return (<div>{details}</div>)
}

function NewPlayer({addPlayer}) {
  var name;
  var active;
  const form =
  <form onSubmit={e =>{
    e.preventDefault();
    addPlayer(name.value, active.checked)}
    }
  >
    <input ref={node => (name=node)}/>
    <br></br>
    <input type="checkbox" ref={node => (active=node)}/>
    <button type="submit"> Add player </button>
  </form>
  return (
    <div>
      <div>{form}</div>
    </div>
  )

};

const mapStateToProps = state => ({
  singlePlayer: state.reducer,
  player: state.secondReducer
});

const mapDispatchToProps = {
  addPlayer,
  checkPlayer,
  deletePlayer,
  playerActive
};

const App1 = connect(
  mapStateToProps,
  mapDispatchToProps
)(AllPlayers)

const App2 = connect(
  mapStateToProps,
  mapDispatchToProps
)(NewPlayer)

const App3 = connect(
  mapStateToProps,
  mapDispatchToProps
)(Counter)

const App4 = connect(
  mapStateToProps,
  mapDispatchToProps
)(DetailedPlayer)

ReactDOM.render(
  <Provider store = {store}>
    <div>
      <App1 />
      <App2 />
      <App4 />
    </div>
  </Provider>,
  document.getElementById('root'));

</script>
